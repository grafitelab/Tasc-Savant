/* http://mattduvall.com/grande.js */!function(){function e(){var e=F.createElement("div"),t="<div class='options'>           <span class='no-overflow'>             <span class='ui-inputs'>               <button class='bold'>B</button>               <button class='italic'>i</button>               <button class='header1'>h1</button>               <button class='header2'>h2</button>               <button class='quote'>&rdquo;</button>               <button class='url useicons'>&#xe001;</button>               <input class='url-input' type='text' placeholder='Paste or type a link'/>             </span>           </span>         </div>",n=F.createElement("div"),r=F.createElement("div");r.className="g-body",F.body.appendChild(r),n.innerHTML="<div class='pos-abs file-label'>Insert image</div>                                         <input class='file-hidden pos-abs' type='file' id='files' name='files[]' accept='image/*' multiple/>",n.className="image-tooltip hide",e.className="text-menu hide",e.innerHTML=t,0===F.querySelectorAll(".text-menu").length&&(r.appendChild(e),r.appendChild(n)),P=F.querySelectorAll(".file-label + input")[0],D=F.querySelectorAll(".image-tooltip")[0],A=F.querySelectorAll(".text-menu")[0],O=F.querySelectorAll(".text-menu .options")[0],M=F.querySelectorAll(".text-menu .url-input")[0]}function t(){var e,t,s;for(F.onmousedown=k,F.onmouseup=function(e){setTimeout(function(){k(e)},1)},F.onkeydown=c,F.onkeyup=function(e){var t=window.getSelection();t.anchorNode&&"ARTICLE"!==t.anchorNode.nodeName&&(h(e),t.isCollapsed&&m(e))},j.onresize=k,M.onblur=b,M.onkeydown=w,U.allowImages&&(D.onmousedown=r,P.onchange=i,F.onmousemove=n),e=0,t=I.length;t>e;e++)s=I[e],s.contentEditable=!0,s.onmousedown=s.onkeyup=s.onmouseup=k}function n(e){s(e,e.target)}function r(){var e=q.children,t=q.getBoundingClientRect();H=o(e,t)}function i(){var e,t=this.files[0],n=new FileReader;n.onload=function(){return function(t){e=F.createElement("figure"),e.innerHTML='<img src="'+t.target.result+'"/>',q.insertBefore(e,H.bottomElement)}}(t),n.readAsDataURL(t)}function s(){var e=q.children,t=q.getBoundingClientRect(),n=o(e,t);n?(D.style.left=t.left-90+"px",D.style.top=n.top-17+"px"):(D.style.left=B+"px",D.style.top=B+"px")}function o(e){var t,n,r,i,s,o,u,a,f=[];for(n=0,r=e.length-1;r>n;n++)i=e[n],s=e[n+1]||null,o=i.getBoundingClientRect().bottom-5,u=s.getBoundingClientRect().top,f.push({top:u,bottom:o,topElement:i,bottomElement:s,index:n+1});for(a=event.pageY-j.scrollY,n=0,r=f.length;r>n;n++)if(t=f[n],a<t.top&&a>t.bottom)return t;return null}function u(e){var t,n,r,i=F.querySelectorAll(".text-menu button"),s=function(t){e(t)};for(t=0,n=i.length;n>t;t++)r=i[t],s(r)}function a(){u(function(e){e.onmousedown=function(){y(e)}})}function f(){return j.getSelection().focusNode}function l(){var e,t,n,r=f();u(function(i){e=i.className;for(var s in tagClassMap)if(t=tagClassMap[s],n=new RegExp(t),n.test(e)){i.className=N(r,s)?t+" active":t;break}})}function c(e){var t,n=window.getSelection(),r=T(n.anchorNode,"p");13===e.keyCode&&r&&(prevSibling=r.previousSibling,t=prevSibling&&"HR"===prevSibling.nodeName&&!r.textContent.length,t&&e.preventDefault())}function h(e){var t,n=window.getSelection();13===e.keyCode&&("DIV"===n.anchorNode.nodeName&&E("p"),t=T(n.anchorNode,"p"),t&&p(t))}function p(e){var t,n,r;for(t=e.previousSibling,n=t;n&&n.nodeType==Node.TEXT_NODE;)n=n.previousSibling;"P"!==t.nodeName||t.textContent.length||"HR"===n.nodeName||(r=F.createElement("hr"),r.contentEditable=!1,e.parentNode.replaceChild(r,t))}function d(e){var t;return t=e.nodeType===Node.TEXT_NODE?"data":R?"textContent":"innerText"}function v(e,t,n){var r="ol"===n?"insertOrderedList":"insertUnorderedList",i="ol"===n?3:2;return F.execCommand(r),e.anchorNode[t]=e.anchorNode[t].substring(i),T(e.anchorNode,n)}function m(){var e,t,n,r,i,s,o=window.getSelection();o.isCollapsed&&o.anchorNode&&"ARTICLE"!==o.anchorNode.nodeName&&(e=d(o.anchorNode),t=o.anchorNode[e],t.match(/^[-*]\s/)&&"LI"!==o.anchorNode.parentNode.nodeName&&(n=v(o,e,"ul")),t.match(/^1\.\s/)&&"LI"!==o.anchorNode.parentNode.nodeName&&(n=v(o,e,"ol")),r=n&&["ul","ol"].indexOf(n.nodeName.toLocaleLowerCase())>=0&&["p","div"].indexOf(n.parentNode.nodeName.toLocaleLowerCase())>=0,r&&(i=o.anchorNode,s=n.parentNode,s.parentNode.insertBefore(n,s),s.parentNode.removeChild(s),g(o,i)))}function g(e,t){range=F.createRange(),range.setStart(t,0),range.setEnd(t,0),e.removeAllRanges(),e.addRange(range)}function y(e){var t,n,r=e.className,i=window.getSelection(),s=i.anchorNode;for(var o in tagClassMap)if(t=tagClassMap[o],n=new RegExp(t),n.test(r))switch(o){case"b":return!s||N(s,"h1")||N(s,"h2")||F.execCommand(t,!1),void 0;case"i":return F.execCommand(t,!1),void 0;case"h1":case"h2":case"h3":case"blockquote":return E(o),void 0;case"a":return S(),O.className="options url-mode",void 0}k()}function b(){var e=M.value;return O.className="options",window.getSelection().addRange(_),F.execCommand("unlink",!1),""===e?!1:(e.match("^(http://|https://|mailto:)")||(e="http://"+e),F.execCommand("createLink",!1,e),M.value="",void 0)}function w(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),M.blur())}function E(e){N(f(),e)?(F.execCommand("formatBlock",!1,"p"),F.execCommand("outdent")):F.execCommand("formatBlock",!1,e)}function S(){setTimeout(function(){var e=C(f());"undefined"!=typeof e?M.value=e:F.execCommand("createLink",!1,"/"),_=window.getSelection().getRangeAt(0),M.focus()},150)}function x(e,t,n){if(null!==e)for(;e.parentNode;){if(t(e))return n(e);e=e.parentNode}}function T(e,t){var n=function(e){return e.nodeName.toLowerCase()===t},r=function(e){return e};return x(e,n,r)}function N(e,t){return!!T(e,t)}function C(e){var t=function(e){return"undefined"!=typeof e.href},n=function(e){return e.href};return x(e,t,n)}function k(e){var t,n,r=j.getSelection(),i=e.target||e.srcElement;return i.isContentEditable?(r.isCollapsed?(L(B,B),A.className="text-menu hide"):(t=r.getRangeAt(0),n=t.getBoundingClientRect(),l(),L(n.top-5+j.pageYOffset,(n.left+n.right)/2)),void 0):(l(),void 0)}function L(e,t){A.style.top=e+"px",A.style.left=t+"px",U.animate&&(A.className=e===B?"text-menu hide":"text-menu active")}var A,O,M,_,D,P,H,B=-999,j=this,F=this.document,I=F.querySelectorAll(".g-body article"),q=I[0],R=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,U={animate:!0};grande={bind:function(n,r){n&&(I=n),U=r||U,e(),t(),a()},select:function(){k()}},tagClassMap={b:"bold",i:"italic",h1:"header1",h2:"header2",a:"url",blockquote:"quote"},j.grande=grande}.call(this);grande.bind(document.querySelectorAll("article"));